<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #box {
      position: absolute;
      width: 200px;
      height: 200px;
      background-color: skyblue;
      opacity: 1;
      position: absolute;
      left: 0;
    }
  </style>
</head>

<body>
  <button id="btn">点我</button>
  <!-- JS请求脚本请求会阻塞渲染 -->
  <!-- <script src="http://localhost:3000/sources"></script> -->
  <div id="box"></div>
  <script>
    
    document.addEventListener('touchstart', (e) => {
      if (document.querySelector('#xin')) {
        document.querySelector('#xin').remove();
      }
      var div = document.createElement('div')
      div.id = 'xin';
      div.style.position = 'absolute'
      div.style.fontSize = '28px'
      div.style.color = '#7cb305'
      div.innerHTML = '❤';
      div.style.left = e.changedTouches[0].clientX + 'px'
      div.style.top = e.changedTouches[0].clientY + 'px'
      document.body.appendChild(div)
      div.style.opacity = 0;
      document.body.append(div)
      animation(div, {
        opacity: 1,
        fontSize: 45,
      }, function () {
        setInterval(() => {
          animation(div,{
            fontSize: 15
          },function () {
            animation(div,{
              fontSize: 45
            })
          })
        }, 300);
      })
    })

    document.addEventListener('click', (e) => {
      console.log(e.pageX);
      console.log(e.pageY);
      if (document.querySelector('#xin')) {
        document.querySelector('#xin').remove();
      }
      var div = document.createElement('div')
      window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
      div.id = 'xin';
      div.style.position = 'absolute'
      div.style.fontSize = '15px'
      div.style.color = 'rgb(245,34,45)'
      div.innerHTML = '❤';
      div.style.left = e.pageX - 19 + 'px'
      div.l = e.pageX - 19 + 'px'
      div.style.top = e.pageY - 22 + 'px'
      div.t = e.pageY - 22 + 'px'
      div.style.opacity = 0;
      document.body.append(div)
      animation(div, {
        opacity: 1,
        fontSize: 45,
      }, function () {
        setInterval(() => {
          animation(div,{
            fontSize: 15
          },function () {
            animation(div,{
              fontSize: 45
            })
          })
        }, 600);

        // setTimeout(() => {
        //   animation(div, {
        //     fontSize: 15,
        //     left: e.pageX - 40,
        //     top: e.pageY - 40,
        //   }, function () {
        //     animation(div, {
        //       fontSize: 15,
        //       left: e.pageX + 80,
        //       top: e.pageY - 40,
        //     }, function () {
        //       animation(div, {
        //         fontSize: 15,
        //         left: e.pageX + 80,
        //         top: e.pageY + 80,
        //       }, function () {
        //         animation(div, {
        //           fontSize: 15,
        //           left: e.pageX - 80,
        //           top: e.pageY + 80,
        //         }, function () {
        //           animation(div, {
        //             fontSize: 15,
        //             left: e.pageX - 80,
        //             top: e.pageY - 40,
        //           },function () {
        //             animation(div,{
        //               left: e.pageX - 80 + 'px',
        //               top : e.pageY - 80 + 'px',
        //               fontSize: 45,
        //             })
        //           })
        //         })
        //       })
        //     })
        //   })
        // }, 100)
     
      })


    })

    let box = document.querySelector('#box')
    animation(box, {
      opacity: .2
    })

    function getStyle(element, attr) {
      return window.getComputedStyle ? window.getComputedStyle(element, null)[attr] : element.currentStyle[attr];
    }
    
    

    function animation(element, json, fn) {
      clearInterval(element.timeId);

      element.timeId = setInterval(function () {
        var flag = true;

        for (var attr in json) {

          if (attr == "opacity") {

            var current = getStyle(element, attr) * 100;

            var target = json[attr] * 100;
            var step = (target - current) / 10;
            step = step > 0 ? Math.ceil(step) : Math.floor(step);
            current += step;
            element.style[attr] = current / 100;
          } else if (attr == "zIndex") {

            element.style[attr] = json[attr];
          } else {
            var current = parseInt(getStyle(element, attr));

            var target = json[attr];
            var step = (target - current) / 10;
            step = step > 0 ? Math.ceil(step) : Math.floor(step);
            current += step;
            element.style[attr] = current + "px";
          }
          if (current != target) {
            flag = false;
          }
        }
        if (flag) {
          clearInterval(element.timeId);

          if (fn) {
            fn();
          }
        }



      }, 25);
    }
  </script>
</body>
 
</html>